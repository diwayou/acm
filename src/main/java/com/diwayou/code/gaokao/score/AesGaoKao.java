package com.diwayou.code.gaokao.score;

import lombok.extern.slf4j.Slf4j;

import javax.crypto.*;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.PBEKeySpec;
import javax.crypto.spec.SecretKeySpec;
import java.security.InvalidAlgorithmParameterException;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.security.spec.InvalidKeySpecException;
import java.security.spec.KeySpec;

/**
 * 解密aes数据
 * @author gaopeng 2021/4/29
 */
@Slf4j
public class AesGaoKao {

    private static final String password = "D23ABC@#56";
    private static final String salt = "secret";
    private static final String uri = "apidata/api/gk/score/special";
    private static final String algorithm = "AES/CBC/PKCS5Padding";

    public static void main(String[] args) throws InvalidKeySpecException, NoSuchAlgorithmException, IllegalBlockSizeException, InvalidKeyException, BadPaddingException, InvalidAlgorithmParameterException, NoSuchPaddingException {
        String data = "eab8325abc5a1440b7708431e83f79ace38694dfe7ad23799dc1ea375c38e2c704f762ae0d167b18a944e616d112ea214c1fb397cbcca78dbaa5883c23286dee86a46ca5d92a5680755bf225d030bfa1c25c9c973257f169b6c052d7d9be3269fc9600c62c7c295f4fbea67d7c3ee23ceba0bde78c92b52dfdd725503110629a0f7f9d55167a4844e40c35f38644d41dac68e7ee8eccf24f14dd4873cec998b9f81fa365041413b47d9d2dc0ae62453249202a23dfd3605c04cdd7a7872f29b6d484bb2049a260ae1c30a001d441407064a2286206cc42f40e388a26baa645e12b7cddba0f12f74ac9c9efa338952abd64f023b1a8d1e8d6b10c37046e84d8aadf2b16dbcf7b658aa2ba9b735885390d9deeee0ca3c50f4a4cb49ce25f748e137d1da8a8f3a044a12eb2797a8d3e162a6f6663ccf67266c934d60530638596bac4bcaa52e4de4344c1efbfef94eddd15661a6905c75901f8636104cbfc2586801d79ffce2b35615fd509ce911895d1c1ef02b5a6ce1a63eb1bec28d3a4a63a5e867d38a4d89638657f04077823ea53c2ce50876d766b4875cf9b6f611a1d4d4503c8a1308018fb82030a63b01c1d0c3803108f98a3c2ceb3b3122c7293543c27cc7b98441d4ab396e1f00fd65ec964b36cfe30c51b0f3866e096e00fe19b505caec7e9ae69a8d69e3f6e50474e5ce2e7711e10300b1dd33e54ace012dcd2db087def81a7e47fb3dd7f716bd27a3509a2ca2fedb660098185f740401ace35daa99305d7f9a5b3fac94fdf18df96b1aec16fac7cb969559a781c818904c584f2ff06d3a098483b3c63327ccabc6455420a67f1f74e854c03deff6ba3c074d64e1635391f4e6e9b1555816d739be2077390f2c2e59b4e8c70478cac3019d67922aacacac09e0cd7b3aed051679462955c969285d093a16a892a4951f1b04afaa4734a9d56735780dd85a86f8e35c2611016939708e2f215223c5ca27a254f60b7065f0004a6c1b83d6742e5578ed5ab5497aeb2c0e9d7d18dd6555581e7de4df10c30bfc2cb48d840f8a7f0b483cd421927ba3bdbc23e8673afd2a4934675c06a2c7f924ec5752915c5af55782a3d44295f8487f0d604c72e81296f7d1dd7d8e6f4d461b2cab033c7bd1bff37b918f1c0ed557ee8b39acb7fa3309a580dad58cf63a9d39599650ce37e70aa750acbdd66106447a9d92985ff8ba6325fb90433a66c163e174ed4efaaec58530eeb7b44e6009038994cfb8ccb0b2800fced4c84bdb0ccd2c8ffc4f6d7fda8df8a658d8a5c4e786d122fec1706b9ae6a0726b942b38093675dcf01475fc77b617d639a04c146f2da6b798e584ccd550dd1a73d506a68b1f4980dcb3a7e487d7c26bef38a5c1e8a447184c383df216b94615b48a4971168cb2288defd46fd24fb6b387157207f59c7ba30b8bdfa3b27d9ab9a75749254c3148f5c3f2e0195d4c2036d62517a5709fcdcc8a382470f6d2e273540d62f442e7d5f87b9485a59c365bea32081f896fe394fa679db07b9f37a065bb958702ad592e97545a2496dde13ddf66e6bca33f4b6338041ad981906f2de84e78d5a8bbc6c5a6cbcfc660f572ed5dbcff0a48bc2ba1df0b1819b978cffa726b65a599d0e5cf62293b2dfe29e503c7deceada06a7f967a98688026b9c93ea3832b1c49b366f71952d4cb1a78c2fb64ab8dad299bb955105eb5367942e2ca2165b56106cff270b16cfa82b5c1a166a35a7e32041e2568d689cab817c28d1d1203ccd61fba5410d6cfe283b17e89993ac7972502e2dffa3d73312adcd25d64234bbbf794fd8a287387519c844fb2d98de988a64044579818d355249c17a2a92f99d51ec1eaada683089c7fbe074608d4f27388aee6bab39dec172444a2eacc319926a57c6a28b6a249f4068c521f6e215215da0cfa096fcb4a6f8def053c2d0d11adf731ac1332a2f688c57453a72508e830a2855ac4f945dae89def5a3a81bc3ba567f769c8de20ba30eda5adb03aca9b8a00612bae0f0e20362eb8d62bc07fcc6fc4b23a3bc151f54fb9c1e93582607662c26c59bf9c341356da287e9a4b8fad2f3a1434a4fa8b18fa0894b9e86fc84b248b232e5f21c35bd39e390aa639dbe227a08f9542b5d8cc22752728f7243f8ffc420b018a44bbf0350f72ccd0d83bc634a709cd9da26be6699fa896894ea4d028551b2bfcff4dbe1ecac24afb86438e65fb46cc454311554c524681afa0f3e7d3a7923bc478677da168a3732fc93db7cd4a1a4ddc69342bf7791f20797911fd008a9a50fd8641ecf2e7e6d0e035d762e8d2aaa3e8e3b56de8fb8728e5e28e604545f51e468292a3b3ce39f21697d6cd9d8467ecbad950fe6fa68caf837233a8ba2a9a8e99966e95ac439f2dbccd19e6bb64afde9e21c50dabe271480054915d14b4e72bbda47d7c30a13c528eaabc2d15319ad25a50f68f9b1b4e44533d2edfac0c2eae7b0c49506c1e97023e8d8368604e6c6ea306370441ce59f35022379b81b995b04fad50962a7ecabfc28ab7fc067c0046eb87c4df0ecca5ccc751fcadf5cbe8c663c20546c55591bf2df21d86e3294f2412c9248cb4cd5b5ececbc0c9921ab9bc404b4d44b6b69a8084705a4df758405b258eec29488c0b70bd3677af244041dd3789ebffd46d76f4d073f632853bc4d4359adb9d16734dc326cd4e0252fdfd5e4007dbf6a8527885c4a13ab6bad8af240b6db17f9812839ffd16778613e4827db956a1929c2df63338573fdf5364e72c9cc5cb0750151b68b29a8a257f1daa60dca52b7bfde23ed3c3295d58e662c5f5a03141914bfbf216ed4d455a4884d884baffabc63f4354750547335bd179731f227f71353fed4b07eb3e82f84f26d022821761524a694fbb2bdfcb3dba22ee743a23d94c2cc3b488dedde0d9fc95bc286ec6fc54f7b999c33b4d20a0d93556dd819b886f67c0f790c3521278ed652cd5c28c2501e031b3aa4417109c583abd6ffff836f5974f4433b49b832acc65df097235bc81cde6da909b318f748771c2e56cdb8e0ec1ef3dd33c1d2ee38bb817027bab6db75fca234a8365dbcbec53f654d17c49d711a3642948773a5b8206dfadb7f41a9a1e5ba6d192a841ec75bc0f76906983cae72cdbe7bbd41ae46898437492989a407d7e287b017d50efdd71b8aab4621e6cb99b741f3b1a1baaae16879e6ed2a2a7e4e65c6645566ab5b012a56c315cea25860c42ff70c3ab27fff0dc75c368342524423fc81504ad564ea4dc78b186f091abc2acabfc8425ad02fcc17d59965d8a13563e569b87e3e2ade4297b0aaab7378cc9a2cd7fe10191362bf94f37033e78adde5871ea5e5f3defd0859b288b92665d074a693d39165e7a2a727f2a0caa3ef9130bbbfd058cad5c22417dc6ee843b449bb8d4d94b2705f6bb0bda201c1698d422e05bff79fc2e2fd737ba921c69b55f4bcd9b81a706a980ed9486995dd5a9cbb3c9f8240a6f0bf6cb9792617aab9b489fbf1225dbeed77b1618c72d4e50d0356cdcb4bca1f59868d8548d2ca3367325bc6e4f4cd180ebda5d0c327fd51d3164ad7b6e5c92e084651f3f018ef0aae6de3f513456aa5d2c72f7c1a283ad39dcc21d9971c67d84b682152bd8bf08a59e2be74c42ec1221005a38b5a1b21074fa26d3754da5e686ef2e69b40ad53130482754cbff905eec5b16cef85a71d90dad3cdec1a405086abbcc07b7f844400a8d873611a0d54c2a21fe2d827a97fdbbf80e1f390895e26dbf648b68d861d089843c454f601e53ae278532346a9839003b52b50056ee2266734414809577c05facbda0bdd5000bc40d18c5e8b24539880c939e714c8412a0481d07298c1e069dc068bcb3df1c2cc8adc6690f64e91325ab150c41e5f0116f55d9af2d5bf7db638640d108006758db55a58b7c8a5ea530aebc640b642df123ae03bd77ef08c075670ec8577e5482b1340b5f7fe82655ee2699a2ecd5bafc60206b28fe9f5ddcff67cc3f2bd496547d0d4a63ab09a62b6531c6e7fc21a68a8c50c7ad198d943db615dbcbc0eed087834dafe4aeee02506250f28d7ebe6b847642c9250b10c689e2610f8fe699f13e39f7f368e0db485d4cd83c792b86492b959f4b8b9e2633f8168ec0f5299593de21e33494d040f7a406e30362eacbe763135ba312d97e0bc04b854d2b84173d613d38299f5a09763aa0bd927001786a64f80e83f7f93cbf8162492d81010113c66d03373d6ad5ce2fcc6fa2b2c5fc36ca8633381198045871172dc93c146f85ead1336af93de26de07bfe5e6c88836e71fcb3944e2f6f31d65714af8342de40f108ca854259198483728fec0ee0a516a030c7d93a89e6edd54871cea880728b1b21f8327126d244f058b08b2f1dce0edcb1e63dd28bded0660a1b10a0ed086afbd53e66c18f9df6e5b1fb0916b2a07c2f025e907e22f5571b91c18fe77624532cbea763fb3ea2b1c5de9e52dce74f30490e19d5f777a98aa34c508081ac6432a128eb3af1ce5722d37b5950b27ef21fcd5550d85487074cee5933d06075627dbe0709b3a7f73b175cb01ec4fedaa8584bfb09d55f518cc1e5e3a52db9e5e5d66554eec7110dcb6ea487654cb79c89171ad4bbfa358a8e016567f77e98a160a4ff0711317efe76fe6910b0324c0ea532c2ee3dccaa9d18932c2c820bfdd18d8be076484b0cabf58541da52187b10bc4fa0a4d085c5512681a29d83a3458bc35608e487bdbbab8fcd242651c6e4f75283720c53cb9db7549a2e65a440c3c905969a8f3e693fe3100b1e06bcab2c840de636dc2a05ea36280287e1288406113d2e4a50c2edd4dcc4d13d6d57bd7173bf0c9e12cdc68e8dae534681518864a9680b92ea58652ea418239f48795e822a586da9e834f6e5de742d3101a80ee96c094c9214c4c7f11f4ada258e20329d991dc06b9abad58c342abc4847cce4f9c60efe8e99196b02295112225ef895ac5b142c634a22c881a5302fe7889ddd3eff9e17c37d7dbd3c760a63e30e59d406f350f471dfd005bb7fe456ed3208daf9ccb2b5653f728548903f3d4fe7f1413d8a936e94701e69e30025a7d7e362d45be10571cb04debfbbf0092202cdfede8ed28c7418758bcff219d1fec4834fdee02f7b1460c44760fb82e1ebca31fcf544529f702a150c20584fba6be51c098652cb1b172ed7a2330a2a9c1f001b3c94a8552317cda49f10c1d941f63c1f385048337cc1bb0992551f385a63f6c67cfa41888fdf3b10ce70b12a9a0ecc26bc6560fddd46c9bb1b2d7404c032f49692e61bea3e8b2af67e18a64ec600c7fc4e4c94ace48c4667c6f29d682c519d9e1a1611bd83a1d3319ec0493ddad004dd4c194b842204eef0feeb8d7acbe6825fcbd6b56650f7c3d232a4cdabf244dd28ba3bf71272c8f24147ae38194bc38765cd65604d6e9aa8004f17fce7fc2dc5273773f165a5431ebf4022cfca6ab36c8a8d37e16cc0dc240c26baecd47a99ba7beec07211ab0d25387e183fc83579b7b7a80d8bde937620df19aee878b349d9b4f81510cb75a10e4975c1ceba00f5463ad7fd7e178e115f17aa2401aa9115b385b2ce916b6443ef1496993bf713d13140c094c0ceb827367df2e28286e99cfbe4a383d9ade86b323171e16b1b0c68ba592e01c8358442b71dc544edaa759ce56cf70e962a52699dd96bf3001bda3041916bfb89220373d63807496b3f0251fb32cddd39992d19d8da13162f4186d85e974e0e2352b5f6ebcea102442becdf65043de1f90134da2e23a974bc81890a7a1963ed8d6591d66fe7f356d25a9e5c2089c766ad40637cb838e70fac5e0d42de284cc346e5a82221767ae5ba86b7b6c3f16d8c2971ba4d6238ff125896a74961926df7bd1a1fc5ee1ba76cb3e5ac93c1434683fb00bd9291e7bd08f395439c0790413f409b9a04c98ef253ff198e7561f697a4986a97784758d0ba84291f7fc7475ad6d28d0919f770235d7c85060bb0d6d3fe4379716bd7c51226218e399a252f2a087734b9cc91dd2114c2d9163bbdaaa61331b01bc6ad07526abbbe4c7d50621fd9ea48c1a625584dcf19100c3711745171dc338c6184c6ba2062f0414c63d3cd2b79ce6b063085b143454192e8a2f1fb8b25cc3142070cd4536a1a581bf708dea9270b060b3f37c0b52d6e3b8a96b2e5e770d99134019680e42a780d8596d66f8dfbd7a1b732d0020691379019a52f24c8999fa7b74894335c0d6fda6198129665148823ccb59e330f04b588a933f594cd80a560279a646abd0b4effae606e5bdb6ac95cbc2142863bc65829e2d7825cbf5fa59ad1349d12639fac4f0eaf2e61bf2f9214a03119553e7c172369602e61525d8618d6b60c2edc5f56dbcd03309ba7fcda8d80e24087f3ddf3165bf7f977206f3d304f0a855ad4b40096033db7927c7aac62d8c3ec6eba53cf5a6152fc0ee9f008f076cba53ed6b80aee796b077fa88feaae3f4832e848cd38338022033f96c044278d2effac27d78769a98b68d5750ce25af126c406122f96410f99de342b5c8963cd69468597ff79388e41b84f504aa2364d2c417c6e5e526759da4c92a517c6a014d1beab1a15bd5fc8533e4fcbbf4ea5d7cdce039c96a8c7167077369c8a1c8d6a2090e3da58b99dd4818c9ce76d669f40ec88e0a4d372cbe14b22ddefe58817c4f5aac4bf1c372dd755a32b5cfd0c6c21f7e495e85164ece3659f22f18a9811c6ec48cb6bb8c08c7bd3acc0a8e9be0355f01f8c4cace79ee64f237db64e9b37545c9b224d99eb749805a9bee0b6d0e9f014c673d9d72a92ab65f487bbe2312295248b0c2cbd1e4b695fc264e6b9640a0a6956d83430f7097e301ae66c8e5b9719da718b1719802322344a658e44ac476bf22a7afae11e60a1d124b6d41d4af86eadae3b25cb6fbdf5a9c8e68a5a6392c61695b8afaf3510710014cfc6423ef8d66652284cbb5b9e4e52b8d7b7c71ab21fe0ae92dc5c134ae7ece9767e5e5b59256b9f5eea95e1ca0fd8e2c1d6e3796ca829767fcef7d8ec781dbf8472fcf760c75a08f9569fbb9830b7d00ebe7f37378f3ab381188a9ca83e4bbde8ac73ab5638f80489abc448ed33db1eb32505d9d20cd346f2374d8aa114c3375e678fd4a8b931ef92604db39a6a41e44f43ec09deabc2ce07f416f8ba84abc2b80383bddbbbfbc4ea4890f31be9e4126e950fa0921b00e911333cec42f5ff8281d4fe3ff728d2e2e84225da4390c1baab77a066a0d3cff1fa3d91aca41afcd5bc1b0c197ec97027f4c3342b24dbea51b181b62b676e33e4402ce579f2209f388cf1399aee1824acf65f672389ba5cb1a7d400cc641084f0907a3223205d30b18593d4db256fc48c4dca7bf8e0aae9f256514329ce04ae202c3f20a76";

        // https://api.eol.cn/gkcx/api/?access_token=&local_batch_id=14&local_province_id=21&local_type_id=1&page=2&school_id=225&signsafe=61981026db85ba6c5514942d84667159&size=10&special_group=&uri=apidata/api/gk/score/special&year=2020

        System.out.println(decrypt(data));
    }

    public static String decrypt(String data) {
        try {
            byte[] key = getKeyFromPassword(password, salt, 256);
            byte[] iv = getKeyFromPassword(uri, salt, 128);

            return decrypt(algorithm, data, key, new IvParameterSpec(iv));
        } catch (Exception e) {
            log.warn("解析数据失败", e);
        }

        return null;
    }

    private static byte[] getKeyFromPassword(String password, String salt, int keyLength)
            throws NoSuchAlgorithmException, InvalidKeySpecException {

        SecretKeyFactory factory = SecretKeyFactory.getInstance("PBKDF2WithHmacSHA256");
        KeySpec spec = new PBEKeySpec(password.toCharArray(), salt.getBytes(), 1000, keyLength);
        return factory.generateSecret(spec).getEncoded();
    }

    private static String decrypt(String algorithm, String cipherText, byte[] key,
                                 IvParameterSpec iv) throws NoSuchPaddingException, NoSuchAlgorithmException,
            InvalidAlgorithmParameterException, InvalidKeyException,
            BadPaddingException, IllegalBlockSizeException {

        Cipher cipher = Cipher.getInstance(algorithm);
        cipher.init(Cipher.DECRYPT_MODE, new SecretKeySpec(key, "AES"), iv);
        byte[] plainText = cipher.doFinal(hexStringToByte(cipherText));
        return new String(plainText);
    }

    private static byte[] hexStringToByte(String hex) {
        int len = (hex.length() / 2);
        byte[] result = new byte[len];
        char[] achar = hex.toCharArray();
        for (int i = 0; i < len; i++) {
            int pos = i * 2;
            result[i] = (byte) (toByte(achar[pos]) << 4 | toByte(achar[pos + 1]));
        }

        return result;
    }

    private static byte toByte(char c) {
        return (byte) "0123456789abcdef".indexOf(c);
    }
}
